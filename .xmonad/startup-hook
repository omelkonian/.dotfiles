#!/bin/bash

function start {
    if [ -z "$(pgrep $1)" ] ; then
        $1 &
    fi
}

# Network manager
if [ -z "$(pgrep nm-applet)" ] ; then
    nm-applet --sm-disable &
fi

# App launcher
if [ -z "$(pgrep synapse)" ] ; then
    synapse -s &
fi

# Skype
start "skype"

# Thunderbird
start "thunderbird"

echo "Apps started"

# Icon tray and monitor setup
if [ -n "$(pgrep trayer)" ] ; then
    kill $(pgrep trayer)
fi

# Multiple screens setup
if [ -n "$(xrandr | grep "VGA1" | grep " connected ")" ]; then
    # Docked laptop
    xrandr --output LVDS1 --off --output HDMI1 --mode 1280x1024 --pos 0x0 --output VGA1 --mode 1280x1024 --pos 1320x0
    trayer --edge top --align left --monitor 1 --widthtype percent --width 50 --height 20 --transparent true --alpha 0 --tint 0x1b1d1e &
elif [ -n "$(xrandr | grep "DP2" | grep " connected ")" ]; then
    # Work setup
    xrandr --output HDMI1 --auto --output DP2 --auto --output HDMI3 --auto
    trayer --edge top --align left --monitor 0 --widthtype percent --width 50 --height 20 --transparent true --alpha 0 --tint 0x1b1d1e &
else
    # Undocked laptop
    xrandr --output LVDS1 --auto
    trayer --edge top --align left --monitor primary --widthtype percent --width 50 --height 20 --transparent true --alpha 0 --tint 0x1b1d1e &
fi
echo "Monitors configured"
echo "Icon tray spawned"
